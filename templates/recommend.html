<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Recommender System</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script>
        tailwind.config = {
      theme: {
        extend: {
          colors: {
            light: '#F5F6F8',
          }
        }
      }
    }

    function checkImageSize(img) {
            if (img.naturalWidth === 1 && img.naturalHeight === 1) {
                img.src = 'https://www.shutterstock.com/image-vector/classical-book-cover-600nw-94690939.jpg';
                img.width = 103;

            }
        }

    function handleProfileClick(){
        let dropdown=document.getElementById("user-dropdown-menu");
        dropdown.classList.toggle("hidden");
    }

    function changeProfilePicture(){
        let imageContainer = document.getElementById("profile-picture");
        let userName=document.getElementById("profile-name");
        let googleLogin = document.getElementById("google-login");
        let logout = document.getElementById("logout");

        const userInfoString = localStorage.getItem('user');

        if (!userInfoString) {
            imageContainer.src = "https://t3.ftcdn.net/jpg/03/64/62/36/360_F_364623643_58jOINqUIeYmkrH7go1smPaiYujiyqit.jpg";
            userName.textContent="User";
            googleLogin.style.display = "block";  // Show Google login button
            logout.style.display = "none"; // Hide logout button
            return;
        }else{
            const userInfo = JSON.parse(userInfoString);
            const profileImageUrl = userInfo.photoURL;
            imageContainer.src = profileImageUrl;

            userName.textContent=userInfo.displayName;

            googleLogin.style.display = "none";   // Hide Google login button
            logout.style.display = "block";       // Show logout button
        }


    }

    function deleteUserFromLocalStorage(){
        localStorage.removeItem("user");
        changeProfilePicture();
    }

    document.addEventListener('DOMContentLoaded', function() {
        changeProfilePicture();
    });




    </script>

</head>
<body class="bg-light">

<nav class="bg-gray-800">
    <div class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
        <div class="relative flex h-16 items-center justify-between">
            <div class="absolute inset-y-0 left-0 flex items-center sm:hidden">
                <!-- Mobile menu button-->
                <button type="button"
                        class="relative inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
                        aria-controls="mobile-menu" aria-expanded="false">
                    <span class="absolute -inset-0.5"></span>
                    <span class="sr-only">Open main menu</span>
                    <!--
                      Icon when menu is closed.

                      Menu open: "hidden", Menu closed: "block"
                    -->
                    <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                         aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/>
                    </svg>
                    <!--
                      Icon when menu is open.

                      Menu open: "block", Menu closed: "hidden"
                    -->
                    <svg class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                         aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="flex flex-1 items-center justify-center sm:items-stretch sm:justify-start">
                <div class="flex flex-shrink-0 items-center">
                    <!--                    <img class="h-8 w-auto" src="https://tailwindui.com/img/logos/mark.svg?color=indigo&shade=500"-->
                    <!--                         alt="Your Company">-->
                    <svg width="123" height="23" viewBox="0 0 123 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1.3 22C1.1 22 0.93 21.94 0.79 21.82C0.67 21.68 0.61 21.51 0.61 21.31V1.72C0.61 1.5 0.67 1.33 0.79 1.21C0.93 1.07 1.1 0.999999 1.3 0.999999H2.8C3.04 0.999999 3.22 1.06 3.34 1.18C3.46 1.3 3.53 1.4 3.55 1.48L9.91 13.6L16.3 1.48C16.34 1.4 16.41 1.3 16.51 1.18C16.63 1.06 16.81 0.999999 17.05 0.999999H18.52C18.74 0.999999 18.91 1.07 19.03 1.21C19.17 1.33 19.24 1.5 19.24 1.72V21.31C19.24 21.51 19.17 21.68 19.03 21.82C18.91 21.94 18.74 22 18.52 22H17.05C16.85 22 16.68 21.94 16.54 21.82C16.42 21.68 16.36 21.51 16.36 21.31V6.55L11.35 16.33C11.27 16.53 11.15 16.69 10.99 16.81C10.83 16.91 10.63 16.96 10.39 16.96H9.46C9.2 16.96 8.99 16.91 8.83 16.81C8.69 16.69 8.57 16.53 8.47 16.33L3.46 6.55V21.31C3.46 21.51 3.39 21.68 3.25 21.82C3.13 21.94 2.97 22 2.77 22H1.3ZM30.7284 22C30.5284 22 30.3584 21.94 30.2184 21.82C30.0984 21.68 30.0384 21.51 30.0384 21.31V14.23L22.8084 1.99C22.7884 1.93 22.7684 1.87 22.7484 1.81C22.7284 1.75 22.7184 1.68 22.7184 1.6C22.7184 1.44 22.7784 1.3 22.8984 1.18C23.0184 1.06 23.1584 0.999999 23.3184 0.999999H24.8784C25.0584 0.999999 25.2184 1.05 25.3584 1.15C25.4984 1.23 25.5984 1.35 25.6584 1.51L31.5084 11.23L37.3584 1.51C37.4584 1.35 37.5684 1.23 37.6884 1.15C37.8284 1.05 37.9884 0.999999 38.1684 0.999999H39.6984C39.8784 0.999999 40.0284 1.06 40.1484 1.18C40.2684 1.3 40.3284 1.44 40.3284 1.6C40.3284 1.68 40.3184 1.75 40.2984 1.81C40.2784 1.87 40.2484 1.93 40.2084 1.99L33.0084 14.23V21.31C33.0084 21.51 32.9384 21.68 32.7984 21.82C32.6784 21.94 32.5084 22 32.2884 22H30.7284ZM44.3022 22C44.1022 22 43.9322 21.93 43.7922 21.79C43.6522 21.65 43.5822 21.48 43.5822 21.28V1.75C43.5822 1.53 43.6522 1.35 43.7922 1.21C43.9322 1.07 44.1022 0.999999 44.3022 0.999999H53.0022C54.6222 0.999999 55.9422 1.25 56.9622 1.75C57.9822 2.23 58.7322 2.9 59.2122 3.76C59.7122 4.62 59.9622 5.62 59.9622 6.76C59.9622 7.52 59.8222 8.19 59.5422 8.77C59.2822 9.33 58.9522 9.79 58.5522 10.15C58.1722 10.51 57.7922 10.79 57.4122 10.99C58.1922 11.35 58.8822 11.95 59.4822 12.79C60.0822 13.63 60.3822 14.63 60.3822 15.79C60.3822 16.99 60.1122 18.06 59.5722 19C59.0322 19.94 58.2322 20.68 57.1722 21.22C56.1122 21.74 54.8022 22 53.2422 22H44.3022ZM47.7522 18.82H52.7622C53.8422 18.82 54.6622 18.53 55.2222 17.95C55.7822 17.35 56.0622 16.63 56.0622 15.79C56.0622 14.91 55.7722 14.18 55.1922 13.6C54.6322 13.02 53.8222 12.73 52.7622 12.73H47.7522V18.82ZM47.7522 9.61H52.4622C53.5222 9.61 54.3122 9.36 54.8322 8.86C55.3722 8.34 55.6422 7.67 55.6422 6.85C55.6422 6.01 55.3722 5.36 54.8322 4.9C54.3122 4.42 53.5222 4.18 52.4622 4.18H47.7522V9.61ZM72.2186 22.3C70.4386 22.3 68.9086 22.01 67.6286 21.43C66.3486 20.83 65.3486 19.92 64.6286 18.7C63.9086 17.46 63.5186 15.92 63.4586 14.08C63.4386 13.22 63.4286 12.37 63.4286 11.53C63.4286 10.69 63.4386 9.83 63.4586 8.95C63.5186 7.13 63.9186 5.61 64.6586 4.39C65.3986 3.17 66.4086 2.25 67.6886 1.63C68.9886 1.01 70.4986 0.699999 72.2186 0.699999C73.9386 0.699999 75.4486 1.01 76.7486 1.63C78.0486 2.25 79.0686 3.17 79.8086 4.39C80.5486 5.61 80.9486 7.13 81.0086 8.95C81.0486 9.83 81.0686 10.69 81.0686 11.53C81.0686 12.37 81.0486 13.22 81.0086 14.08C80.9486 15.92 80.5586 17.46 79.8386 18.7C79.1186 19.92 78.1086 20.83 76.8086 21.43C75.5286 22.01 73.9986 22.3 72.2186 22.3ZM72.2186 18.85C73.5186 18.85 74.5786 18.47 75.3986 17.71C76.2186 16.93 76.6586 15.67 76.7186 13.93C76.7586 13.05 76.7786 12.24 76.7786 11.5C76.7786 10.74 76.7586 9.93 76.7186 9.07C76.6786 7.91 76.4586 6.97 76.0586 6.25C75.6786 5.51 75.1586 4.98 74.4986 4.66C73.8386 4.32 73.0786 4.15 72.2186 4.15C71.3786 4.15 70.6286 4.32 69.9686 4.66C69.3086 4.98 68.7786 5.51 68.3786 6.25C67.9986 6.97 67.7886 7.91 67.7486 9.07C67.7286 9.93 67.7186 10.74 67.7186 11.5C67.7186 12.24 67.7286 13.05 67.7486 13.93C67.8086 15.67 68.2486 16.93 69.0686 17.71C69.8886 18.47 70.9386 18.85 72.2186 18.85ZM93.078 22.3C91.298 22.3 89.768 22.01 88.488 21.43C87.208 20.83 86.208 19.92 85.488 18.7C84.768 17.46 84.378 15.92 84.318 14.08C84.298 13.22 84.288 12.37 84.288 11.53C84.288 10.69 84.298 9.83 84.318 8.95C84.378 7.13 84.778 5.61 85.518 4.39C86.258 3.17 87.268 2.25 88.548 1.63C89.848 1.01 91.358 0.699999 93.078 0.699999C94.798 0.699999 96.308 1.01 97.608 1.63C98.908 2.25 99.928 3.17 100.668 4.39C101.408 5.61 101.808 7.13 101.868 8.95C101.908 9.83 101.928 10.69 101.928 11.53C101.928 12.37 101.908 13.22 101.868 14.08C101.808 15.92 101.418 17.46 100.698 18.7C99.978 19.92 98.968 20.83 97.668 21.43C96.388 22.01 94.858 22.3 93.078 22.3ZM93.078 18.85C94.378 18.85 95.438 18.47 96.258 17.71C97.078 16.93 97.518 15.67 97.578 13.93C97.618 13.05 97.638 12.24 97.638 11.5C97.638 10.74 97.618 9.93 97.578 9.07C97.538 7.91 97.318 6.97 96.918 6.25C96.538 5.51 96.018 4.98 95.358 4.66C94.698 4.32 93.938 4.15 93.078 4.15C92.238 4.15 91.488 4.32 90.828 4.66C90.168 4.98 89.638 5.51 89.238 6.25C88.858 6.97 88.648 7.91 88.608 9.07C88.588 9.93 88.578 10.74 88.578 11.5C88.578 12.24 88.588 13.05 88.608 13.93C88.668 15.67 89.108 16.93 89.928 17.71C90.748 18.47 91.798 18.85 93.078 18.85ZM106.587 22C106.387 22 106.217 21.93 106.077 21.79C105.937 21.65 105.867 21.48 105.867 21.28V1.75C105.867 1.53 105.937 1.35 106.077 1.21C106.217 1.07 106.387 0.999999 106.587 0.999999H109.227C109.447 0.999999 109.627 1.07 109.767 1.21C109.907 1.35 109.977 1.53 109.977 1.75V8.77L116.757 1.54C116.837 1.44 116.967 1.33 117.147 1.21C117.347 1.07 117.607 0.999999 117.927 0.999999H120.897C121.057 0.999999 121.197 1.06 121.317 1.18C121.457 1.3 121.527 1.45 121.527 1.63C121.527 1.77 121.487 1.89 121.407 1.99L113.157 11.05L121.977 20.98C122.077 21.1 122.127 21.23 122.127 21.37C122.127 21.55 122.057 21.7 121.917 21.82C121.797 21.94 121.657 22 121.497 22H118.407C118.067 22 117.797 21.93 117.597 21.79C117.417 21.63 117.297 21.52 117.237 21.46L109.977 13.51V21.28C109.977 21.48 109.907 21.65 109.767 21.79C109.627 21.93 109.447 22 109.227 22H106.587Z"
                              fill="white"/>
                    </svg>

                </div>
                <div class="hidden sm:ml-6 sm:block">
                    <div class="flex space-x-4">
                        <!-- Current: "bg-gray-900 text-white", Default: "text-gray-300 hover:bg-gray-700 hover:text-white" -->
                        <a href="/" class="text-gray-300 hover:bg-gray-700 hover:text-white block rounded-md px-3 py-2 text-base font-medium"
                           aria-current="page">Home</a>
                        <a href="/recommend"
                           class="bg-gray-900 text-white block rounded-md px-3 py-2 text-base font-medium">Recommend</a>
                    </div>
                </div>
            </div>
            <div class="absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0">

                <!-- Profile dropdown -->
                <div class="relative ml-3">
                    <div class="flex text-white font-medium items-center gap-4">
                        <p id="profile-name">User</p>
                        <button type="button"
                                class="relative flex rounded-full bg-gray-800 text-sm focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-800"
                                id="user-menu-button" aria-expanded="false" aria-haspopup="true"
                                onclick="handleProfileClick()">
                            <span class="absolute -inset-1.5"></span>
                            <span class="sr-only">Open user menu</span>
                            <img id="profile-picture" class="h-8 w-8 rounded-full"
                                 src="https://t3.ftcdn.net/jpg/03/64/62/36/360_F_364623643_58jOINqUIeYmkrH7go1smPaiYujiyqit.jpg"
                                 alt="">
                        </button>
                    </div>

                    <!--
                      Dropdown menu, show/hide based on menu state.

                      Entering: "transition ease-out duration-100"
                        From: "transform opacity-0 scale-95"
                        To: "transform opacity-100 scale-100"
                      Leaving: "transition ease-in duration-75"
                        From: "transform opacity-100 scale-100"
                        To: "transform opacity-0 scale-95"
                    -->
                    <div id="user-dropdown-menu"
                         class="hidden absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
                         role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                        <!-- Active: "bg-gray-100", Not Active: "" -->
                        <button class="block px-4 py-2 text-sm text-gray-700" role="menuitem" tabindex="-1"
                                id="google-login">Sign In With Google
                        </button>
                        <button onclick="deleteUserFromLocalStorage()" class="block px-4 py-2 text-sm text-gray-700"
                                role="menuitem" tabindex="-1"
                                id="logout">Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile menu, show/hide based on menu state. -->
    <div class="sm:hidden" id="mobile-menu">
        <div class="space-y-1 px-2 pb-3 pt-2">
            <!-- Current: "bg-gray-900 text-white", Default: "text-gray-300 hover:bg-gray-700 hover:text-white" -->
            <a href="/" class="bg-gray-900 text-white block rounded-md px-3 py-2 text-base font-medium"
               aria-current="page">Home</a>
            <a href="/recommend"
               class="text-gray-300 hover:bg-gray-700 hover:text-white block rounded-md px-3 py-2 text-base font-medium">Recommend</a>
        </div>
    </div>
</nav>

<div class="container mx-auto max-w-7xl px-2 sm:px-6 lg:px-8 my-10 ">
    <div class="col-md-12">
        <h1 class="" style="font-size:50px">Recommend Books</h1>
        <!--            <form action="/recommend_books" method="post">-->
        <!--                <label>-->
        <!--                    <input name="user_input" type="text" class="form-control">-->
        <!--                </label><br>-->
        <!--                <input type="submit" class="btn btn-lg btn-warning">-->
        <!--            </form>-->
        <form action="/recommend_books" method="post" class="flex items-end gap-4 mt-5">
            <div class="flex-1 max-w-md">
                <label for="username" class="block text-md font-medium leading-6 text-gray-900">Book Title</label>
                <div class="mt-1 flex rounded-md shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-inset focus-within:ring-indigo-600 ">

                    <input type="text" name="user_input" id="username" autocomplete="username"
                           class="block flex-1 border-0 bg-transparent py-1.5 px-4 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6"
                           placeholder="The Catcher in the Rye">
                </div>
            </div>
            <button type="submit"
                    class=" rounded-md bg-indigo-600 px-10 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                Submit
            </button>

        </form>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-black justify-center gap-y-6 mt-14">
        {% if data %}

        {% for i in data %}


        <div class="flex gap-3 flex-col">
            <img class="w-[147px] h-[225px] object-cover shadow-2xl" src="{{i[2]}}" alt="Image"
                 onload="checkImageSize(this)"
                 onerror="this.onerror=null; this.src='https://www.shutterstock.com/image-vector/classical-book-cover-600nw-94690939.jpg';">
            <div class="space-y-1">
                <p class="font-medium text-xl ">{{i[0]}}</p>
                <h4 class="text-black/60 font-medium">{{i[1]}}</h4>
            </div>

        </div>
        {% endfor %}

        {% endif %}


    </div>
</div>

<script type="module">

        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js'
        import { getAuth, GoogleAuthProvider, signInWithPopup  } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js'

        // Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyDUi_TcNDLZS9zDPyIwmVKU1snDgFfw_tM",
            authDomain: "book-recommender-system-31c25.firebaseapp.com",
            projectId: "book-recommender-system-31c25",
            storageBucket: "book-recommender-system-31c25.appspot.com",
            messagingSenderId: "822462847222",
            appId: "1:822462847222:web:82207f4afc55927e2f74d7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // Initialize Firebase Auth
        const auth = getAuth(app); // Use the initialized app

        // Google Auth Provider
        const provider = new GoogleAuthProvider();

        document.getElementById('google-login').addEventListener('click', () => {
            signInWithPopup(auth, provider).then((result) => {
                const credential = GoogleAuthProvider.credentialFromResult(result);
                const token = credential.accessToken;
                const user = result.user;

                // Save user data to local storage
                    localStorage.setItem('user', JSON.stringify({
                        displayName: user.displayName,
                        email: user.email,
                        photoURL: user.photoURL,
                        uid: user.uid
                    }));
                changeProfilePicture();

            }).catch((error) => {
                console.error(error);
            });
        });



</script>

</body>
</html>